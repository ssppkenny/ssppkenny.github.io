{"version":3,"sources":["pz15/events.cljs"],"mappings":"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","names":["js/pz15","js/pz15.events","js/pz15.events.UP","pz15.events/UP","js/pz15.events.DOWN","pz15.events/DOWN","js/pz15.events.LEFT","pz15.events/LEFT","js/pz15.events.RIGHT","pz15.events/RIGHT","pz15.events/states-move","pair","vec__12530","cljs.core.nth","prev_state","state","prev_board","board","prev_zero","zero","cljs.core._EQ_","row","prev_row","zero_prev","cljs.core.get","zero_n","pz15.events/action-to-event","a","pz15.events/states-to-events","states","pairs","cljs.core.map","cljs.core/vector","cljs.core/rest","events","cljs.core/reverse","cljs.core.mapv","cljs.core.conj","cljs.core.map_indexed","b","cljs.core/PersistentVector","cljs.core/count","re_frame.core.reg_event_fx","p__12533","map__12534","cljs.core/--destructure-map","event","db","arg","js/console","cljs.core.assoc","p__12535","map__12536","p__12537","map__12538","p__12539","map__12540","p__12541","map__12542","re_frame.core.reg_event_db","p__12543","map__12544","js/Parallel","solution","pz15.bfs/bfs","fx","p__12545","vec__12546","e","d","p__12549","map__12550","vec__12551","ev","sol","p__12554","vec__12555","p__12558","map__12559","c","cljs.core.async.chan","c__11670__auto__","cljs.core.async.impl.dispatch/run","f__11671__auto__","switch__11573__auto__","state_12564","state_val_12565","inst_12560","inst_12561","inst_12562","cljs.core.async.impl.ioc-helpers/return-chan","statearr-12566","state-machine__11574__auto__","ret-value__11575__auto__","result__11576__auto__","cljs.core/keyword-identical?","ex__11577__auto__","e12567","statearr-12568","cljs.core/seq","statearr-12569","cljs.core/first","state__11672__auto__","statearr-12570","cljs.core.async.impl.ioc-helpers/USER-START-IDX","cljs.core.async.impl.ioc-helpers/run-state-machine-wrapped","cljs.core.async.put_BANG_","s","re-frame.core/dispatch","p__12571","map__12572","p__12573","map__12574","pz15.events/move","f","flag","cljs.core/not","new-state","G__12575","pz15.db/move-down","pz15.db/move-up","pz15.db/move-right","pz15.db/move-left","pz15.db/random-state","_","pz15.db/default-db"],"sourcesContent":["(ns pz15.events\n  (:require\n   [re-frame.core :as re-frame]\n   [re-pressed.core :as rp]\n   [pz15.db :as db]\n   [pz15.bfs :as bfs]\n   [clojure.core.async :as ca]\n   ))\n\n\n(defonce ^:const UP 1)\n\n(defonce ^:const DOWN -1)\n\n(defonce ^:const LEFT 10)\n\n(defonce ^:const RIGHT -10)\n\n(defn states-move [pair]\n  (let [[prev_state state] pair\n        prev_board (:board prev_state)\n        board (:board state)\n        prev_zero (:zero prev_state)\n        zero (:zero state)]\n    (if (not (= zero prev_zero))\n      (- zero prev_zero)\n      (let [row (nth board zero)\n            prev_row (nth prev_board zero)\n            zero_prev (get prev_row 0)\n            zero_n (get row 0)]\n        (* (- zero_n zero_prev) 10)))))\n\n(defn action-to-event [a]\n  (cond\n    (= a UP) ::timeout-up\n    (= a DOWN) ::timeout-down\n    (= a LEFT) ::timeout-left\n    (= a RIGHT) ::timeout-right))\n\n(defn states-to-events [states]\n  (let [pairs (map vector (rest states) states)\n        events (reverse (mapv action-to-event (mapv states-move pairs)))]\n    (conj (map-indexed (fn [a b] (vector b (* 500 a)))  events) [::timeout-solved (* (count states) 500)] )\n    )\n)\n\n(re-frame/reg-event-fx\n  ::timeout-left\n  (fn [{:keys [event db]} arg]\n    (.log js/console event)\n    {:db (assoc db :need-to-solve false :solving true)\n     :fx [ [:dispatch-later {:ms (nth event 1) :dispatch [::key-left 0]}]]\n     }\n    )\n  )\n\n(re-frame/reg-event-fx\n  ::timeout-right\n  (fn [{:keys [event db]} arg]\n    (.log js/console event)\n    {:db (assoc db :need-to-solve false :solving true)\n     :fx [ [:dispatch-later {:ms (nth event 1) :dispatch [::key-right 0]}]]\n     }\n    )\n  )\n\n(re-frame/reg-event-fx\n  ::timeout-up\n  (fn [{:keys [event db]} arg]\n    (.log js/console event)\n    {:db (assoc db :need-to-solve false :solving true)\n     :fx [ [:dispatch-later {:ms (nth event 1) :dispatch [::key-up 0]}]]\n     }\n    )\n  )\n\n(re-frame/reg-event-fx\n  ::timeout-solved\n  (fn [{:keys [db event]} arg]\n    (.log js/console event)\n    {:db (assoc db :need-to-solve false :solving true)\n     :fx [ [:dispatch-later {:ms (nth event 1) :dispatch [::stop-solve 0]}]]\n     }\n    )\n  )\n\n(re-frame/reg-event-fx\n  ::timeout-down\n  (fn [{:keys [db event]} arg]\n    (.log js/console event)\n    {:db (assoc db :need-to-solve false)\n     :fx [ [:dispatch-later {:ms (nth event 1) :dispatch [::key-down 0]}]]\n     }\n    )\n  )\n\n(re-frame/reg-event-db\n  ::stop-solve\n  (fn [db]\n      (assoc db :need-to-solve false :solving false)\n    )\n  )\n\n(re-frame/reg-event-fx\n  ::do-solve\n  (fn [{:keys [db event]} arg]\n      (let [a (new js/Parallel [])\n            solution (.spawn a (bfs/bfs (:state db)))\n            ;;solution (bfs/bfs (:state db))\n            events (states-to-events solution)\n            fx (mapv (fn [[e d] arg] [:dispatch-later {:ms d :dispatch [e 0]} ]) events ) \n            ]\n        {:db (assoc db :solving true)\n         :fx fx\n         }\n      )\n    )\n  )\n\n(re-frame/reg-event-fx\n  ::play-solution\n  (fn [{:keys [db event]} arg]\n    (let [[ev sol] event\n           events (states-to-events sol)\n           fx (mapv (fn [[e d] arg] [:dispatch-later {:ms d :dispatch [e 0]} ]) events ) \n          ]\n        {:db db \n         :fx fx \n         }\n      )\n    )\n  )\n\n\n(re-frame/reg-event-fx\n  ::do-new-solve\n  (fn [{:keys [db event]} arg]\n        (let [ c (ca/chan 10) ]\n         (ca/go (ca/put! c (:state db) (fn [s] (re-frame/dispatch [::play-solution (bfs/bfs (:state db))]\n                                   ))))\n           \n        {:db (assoc db :solving true)\n         }\n    )\n))\n\n(re-frame/reg-event-fx\n  ::new-solve\n  (fn [{:keys [db event]} arg]\n        {:db (assoc db :solving true)\n         :fx [ [:dispatch-later {:ms 500 :dispatch [::do-new-solve 0]}] ]\n         }\n    )\n)\n\n\n(re-frame/reg-event-fx\n  ::solve\n  (fn [{:keys [db event]} arg]\n        {:db (assoc db :solving true)\n         :fx [[:dispatch-later {:ms 100 :dispatch [::do-solve 0]}]]\n         }\n    )\n  )\n\n(defn move [db event f]\n    (let [\n          flag (or (= (nth event 1) 0) (not (:solving db)))\n          new-state (f (:state db))\n          ]\n          (if flag \n             (assoc db :state new-state)\n              db  \n          )\n      ) \n  )\n\n(re-frame/reg-event-db\n  ::key-down\n  (fn [db event]\n    (move db event db/move-down)\n    )\n  )\n(re-frame/reg-event-db\n  ::key-up\n  (fn [db event]\n    (move db event db/move-up)\n    )\n  )\n\n(re-frame/reg-event-db\n  ::key-right\n  (fn [db event]\n    (move db event db/move-right)\n    )\n  )\n\n(re-frame/reg-event-db\n  ::key-left\n  (fn [db event]\n    (move db event db/move-left)\n    )\n  )\n\n(re-frame/reg-event-db\n  ::shuffle\n  (fn [db]\n    (let [\n          new-state (db/random-state)\n          ]\n          (if (not (:solving db))\n            (assoc db :state new-state :need-to-solve false)\n            db\n          )\n      ) \n    )\n  )\n\n(re-frame/reg-event-db\n ::initialize-db\n (fn [_ _]\n   db/default-db))\n\n"]}